(()=>{"use strict";class e{static generateContainer(e,t="",s=""){const i=document.createElement(e);return t&&i.classList.add(t),s&&(i.innerHTML=s),i}}const t=new class{constructor(){this.listeners={}}on(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}emit(e,t){this.listeners[e]&&this.listeners[e].forEach(e=>e(t))}};class s{constructor(e,t="search"){this.container=document.querySelector(e),this.className=t,this.element=null}render(){this.element=e.generateContainer("form",this.className,this.generateHTML()),this.setupEventListeners(),this.container.append(this.element)}generateHTML(){return'\n      <input type="text" name="movie-title" placeholder="Введите название фильма...">\n    '}setupEventListeners(){const e=this.element.querySelector("input");e.addEventListener("input",()=>{t.emit("search",e.value.toLowerCase())})}}class i{constructor(e,t="header"){this.container=document.querySelector(e),this.className=t,this.element=null}render(){this.element=e.generateContainer("header",this.className,this.generateHTML()),this.container.append(this.element),new s(this.className,`${this.className}__search`).render()}generateHTML(){return`\n      <h1 class="${this.className}__title">Cine Mate</h1>\n    `}}class n{constructor(e,t="details"){this.container=document.querySelector(e),this.className=t,this.element=null,this.movie=null,this.setupEvents()}render(){this.container.innerHTML="",this.element=e.generateContainer("main",this.className,this.generateHTML()),this.container.append(this.element)}generateHTML(){return this.movie?`\n        <h3 class="${this.className}__title">${this.movie.Title}</h3>\n        <div class="${this.className}__information">\n          <div class="${this.className}__rating">⭐ ${this.movie.imdbRating}</div>\n          <div class="${this.className}__year">${this.movie.Year}</div>\n          <div class="${this.className}__duration">${this.movie.Runtime}</div>\n          <div class="${this.className}__genre">${this.movie.Genre}</div>\n        </div>\n        <div class="${this.className}__group">        \n          <div class="${this.className}__director">Director: ${this.movie.Director}</div>\n          <div class="${this.className}__actors">Actors: ${this.movie.Actors}</div>\n        </div>\n        <div class="${this.className}__plot">Plot: ${this.movie.Plot}</div>\n      `:'\n        <h3 class="skeleton__title"></h3>\n        <div class="skeleton__information"></div>\n        <div class="skeleton__group"></div>\n        <div class="skeleton__plot"></div>'}setupEvents(){t.on("open-details",e=>{this.movie=e,this.render()})}}class a{constructor(e,t="movie"){this.container=document.querySelector(e),this.className=t,this.element=null}render(t){this.element=e.generateContainer("div",this.className,this.generateHTML(t)),this.setupEventListeners(t),this.container.append(this.element)}generateHTML(e){return`\n      <img class="${this.className}__image" src=${e.Poster} alt="movie poster" />\n\n      <div class="${this.className}__content">\n        <div class="${this.className}__rating">\n          Rating: <span>⭐ ${e.imdbRating}</span>\n        </div>\n\n        <tr>\n\n        <div class="${this.className}__description">\n          <h3 class="${this.className}__title">${e.Title}</h3>\n          <div class="${this.className}__year">Year: ${e.Year}</div>\n        </div>\n      </div>\n    `}setupEventListeners(e){this.element.addEventListener("click",()=>{t.emit("open-details",e)})}}const r=["tt0111161","tt0068646","tt0468569","tt0071562","tt0050083","tt0108052","tt0167260","tt0110912","tt0120737","tt0060196","tt0133093","tt0109830","tt1375666","tt0167261","tt0080684","tt0137523","tt0073486","tt0099685","tt0047478","tt0114369","tt0317248","tt0076759","tt0038650","tt0102926","tt0435761","tt0120815","tt0816692","tt0245429","tt0120689","tt0054215","tt0118799","tt0034583","tt0027977","tt0253474","tt0172495","tt0110413","tt0114814"];class c{constructor(e,t="movies"){this.container=document.querySelector(e),this.className=t,this.element=null,this.setupEvents()}render(t){this.movies=t,this.element=e.generateContainer("main",this.className),this.container.append(this.element),t.map((e,t)=>{if(t<6)return new a(`.${this.className}`).render(e)})}update(e,t=this.movies){this.element.innerHTML="";const s=6*(e-1),i=6*e;t.map((e,t)=>{if(t+1>s&&t<i)return new a(`.${this.className}`).render(e)})}setupEvents(){t.on("select-page",([e,t,s])=>{this.update(t),s(e,t)}),t.on("search",e=>{const t=this.movies.filter(t=>t.Title.toLowerCase().includes(e));this.update(1,t)})}}class l{constructor(e,t="pagination__item"){this.container=document.querySelector(e),this.className=t,this.element=null}render(t){this.element=e.generateContainer("div",this.className,this.generateHTML(t)),this.element.dataset.page=t,this.setupEventListeners(t),this.container.append(this.element)}generateHTML(e){return`\n      <div class="${this.className}-number">${e}</div>\n    `}setupEventListeners(e){this.element.addEventListener("click",s=>{t.emit("select-page",[s,e,this.updateCurrentPage])})}updateCurrentPage(e,t){e.target.closest(".pagination").querySelectorAll("[data-page]").forEach(e=>{e.classList.contains("active")&&e.classList.remove("active"),+e.dataset.page===t&&e.classList.add("active")})}}class o{constructor(e,t="pagination"){this.container=document.querySelector(e),this.className=t,this.element=null}render(t){this.element=e.generateContainer("div",this.className),this.container.append(this.element),this.renderItems(t)}renderItems(e){const t=this.calculatePagesCount(e);for(let e=1;e<=t;e++)new l(`.${this.className}`).render(e)}calculatePagesCount(e){return Math.ceil(e/6)}}class h{async fetchMovies(){try{const e=r.map(e=>this.fetchMovie(e));return await Promise.all(e)}catch(e){console.error(e.message)}}async fetchMovie(e){try{const t=await fetch(`http://www.omdbapi.com/?i=${e}&apikey=295a8d47`);if(!t.ok)throw new Error(`HTTP error: ${t.status}`);const s=await t.json();if(!s)throw new Error("Movie not found");return s}catch(e){throw e}}}const m=new class{constructor(){this.apiService=new h,this.movies=[],this.header=new i("#header-container"),this.moviesList=new c("#movies-container"),this.details=new n("#details-container"),this.pagination=new o("#pagination-container")}init(){this.loadMovies()}render(){this.header.render(),this.moviesList.render(this.movies),this.details.render(),this.pagination.render(this.movies.length)}async loadMovies(){try{this.movies=await this.apiService.fetchMovies(),this.render()}catch(e){}}};document.addEventListener("DOMContentLoaded",()=>{m.init()})})();